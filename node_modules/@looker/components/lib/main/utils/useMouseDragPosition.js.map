{"version":3,"file":"useMouseDragPosition.js","names":["useMouseDragPosition","targetRef","useState","isMouseDown","setIsMouseDown","x","y","mousePos","setMousePos","updateMousePos","e","event","get","pageX","clientX","pageY","clientY","handleStart","requestAnimationFrame","handleMove","throttle","handleEnd","useEffect","addEventListener","window","removeEventListener"],"sources":["../../../src/utils/useMouseDragPosition.ts"],"sourcesContent":["/**\n * Copyright (c) 2023 Google LLC\n * SPDX-License-Identifier: MIT\n */\n\nimport { useState, useEffect } from 'react'\nimport throttle from 'lodash/throttle'\nimport get from 'lodash/get'\n\ninterface MouseState {\n  mousePos: { x: number; y: number }\n  isMouseDown: boolean\n}\n\n/*\n * Starts tracking mouse position when user clicks inside targetRef.\n * Stops  updating mouse position when user releases mouse ANYWHERE in the window\n */\nexport function useMouseDragPosition(\n  targetRef: HTMLElement | null\n): MouseState {\n  const [isMouseDown, setIsMouseDown] = useState(false)\n  const [mousePos, setMousePos] = useState({ x: 0, y: 0 })\n\n  const updateMousePos = (e: globalThis.TouchEvent | globalThis.MouseEvent) => {\n    // use e.touches[0] for touch events, or simply e for mouse events\n    const event = get(e, 'touches[0]', e)\n    // e.clientX and e.clientY fallbacks are included for testing purposes. jsDOM doesn't support pageX/pageY attributes\n    const { pageX, clientX, pageY, clientY } = event\n    setMousePos({ x: pageX || clientX, y: pageY || clientY })\n  }\n\n  const handleStart = (e: globalThis.TouchEvent | globalThis.MouseEvent) => {\n    // update mouse down state AFTER mouse position state is updated\n    requestAnimationFrame(() => {\n      setIsMouseDown(true)\n    })\n    updateMousePos(e)\n  }\n\n  const handleMove = throttle(updateMousePos, 100)\n\n  const handleEnd = () => {\n    requestAnimationFrame(() => {\n      setIsMouseDown(false)\n    })\n  }\n\n  useEffect(() => {\n    targetRef && targetRef.addEventListener('mousedown', handleStart)\n    targetRef && targetRef.addEventListener('touchstart', handleStart)\n    window.addEventListener('mouseup', handleEnd)\n    window.addEventListener('touchend', handleEnd)\n\n    if (isMouseDown) {\n      window.addEventListener('touchmove', handleMove)\n      window.addEventListener('mousemove', handleMove)\n      window.addEventListener('mouseleave', handleEnd)\n    }\n\n    return () => {\n      targetRef && targetRef.removeEventListener('mousedown', handleStart)\n      targetRef && targetRef.removeEventListener('touchstart', handleStart)\n      window.removeEventListener('mouseup', handleEnd)\n      window.removeEventListener('touchend', handleEnd)\n\n      if (isMouseDown) {\n        window.removeEventListener('touchmove', handleMove)\n        window.removeEventListener('mousemove', handleMove)\n        window.removeEventListener('mouseleave', handleEnd)\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isMouseDown, targetRef])\n\n  return { isMouseDown, mousePos }\n}\n"],"mappings":";;;;;;;;AAKA;AACA;AACA;;AAWO,SAASA,oBAAoB,CAClCC,SAA6B,EACjB;EACZ,gBAAsC,IAAAC,eAAQ,EAAC,KAAK,CAAC;IAAA;IAA9CC,WAAW;IAAEC,cAAc;EAClC,iBAAgC,IAAAF,eAAQ,EAAC;MAAEG,CAAC,EAAE,CAAC;MAAEC,CAAC,EAAE;IAAE,CAAC,CAAC;IAAA;IAAjDC,QAAQ;IAAEC,WAAW;EAE5B,IAAMC,cAAc,GAAG,SAAjBA,cAAc,CAAIC,CAAgD,EAAK;IAE3E,IAAMC,KAAK,GAAG,IAAAC,eAAG,EAACF,CAAC,EAAE,YAAY,EAAEA,CAAC,CAAC;IAErC,IAAQG,KAAK,GAA8BF,KAAK,CAAxCE,KAAK;MAAEC,OAAO,GAAqBH,KAAK,CAAjCG,OAAO;MAAEC,KAAK,GAAcJ,KAAK,CAAxBI,KAAK;MAAEC,OAAO,GAAKL,KAAK,CAAjBK,OAAO;IACtCR,WAAW,CAAC;MAAEH,CAAC,EAAEQ,KAAK,IAAIC,OAAO;MAAER,CAAC,EAAES,KAAK,IAAIC;IAAQ,CAAC,CAAC;EAC3D,CAAC;EAED,IAAMC,WAAW,GAAG,SAAdA,WAAW,CAAIP,CAAgD,EAAK;IAExEQ,qBAAqB,CAAC,YAAM;MAC1Bd,cAAc,CAAC,IAAI,CAAC;IACtB,CAAC,CAAC;IACFK,cAAc,CAACC,CAAC,CAAC;EACnB,CAAC;EAED,IAAMS,UAAU,GAAG,IAAAC,oBAAQ,EAACX,cAAc,EAAE,GAAG,CAAC;EAEhD,IAAMY,SAAS,GAAG,SAAZA,SAAS,GAAS;IACtBH,qBAAqB,CAAC,YAAM;MAC1Bd,cAAc,CAAC,KAAK,CAAC;IACvB,CAAC,CAAC;EACJ,CAAC;EAED,IAAAkB,gBAAS,EAAC,YAAM;IACdrB,SAAS,IAAIA,SAAS,CAACsB,gBAAgB,CAAC,WAAW,EAAEN,WAAW,CAAC;IACjEhB,SAAS,IAAIA,SAAS,CAACsB,gBAAgB,CAAC,YAAY,EAAEN,WAAW,CAAC;IAClEO,MAAM,CAACD,gBAAgB,CAAC,SAAS,EAAEF,SAAS,CAAC;IAC7CG,MAAM,CAACD,gBAAgB,CAAC,UAAU,EAAEF,SAAS,CAAC;IAE9C,IAAIlB,WAAW,EAAE;MACfqB,MAAM,CAACD,gBAAgB,CAAC,WAAW,EAAEJ,UAAU,CAAC;MAChDK,MAAM,CAACD,gBAAgB,CAAC,WAAW,EAAEJ,UAAU,CAAC;MAChDK,MAAM,CAACD,gBAAgB,CAAC,YAAY,EAAEF,SAAS,CAAC;IAClD;IAEA,OAAO,YAAM;MACXpB,SAAS,IAAIA,SAAS,CAACwB,mBAAmB,CAAC,WAAW,EAAER,WAAW,CAAC;MACpEhB,SAAS,IAAIA,SAAS,CAACwB,mBAAmB,CAAC,YAAY,EAAER,WAAW,CAAC;MACrEO,MAAM,CAACC,mBAAmB,CAAC,SAAS,EAAEJ,SAAS,CAAC;MAChDG,MAAM,CAACC,mBAAmB,CAAC,UAAU,EAAEJ,SAAS,CAAC;MAEjD,IAAIlB,WAAW,EAAE;QACfqB,MAAM,CAACC,mBAAmB,CAAC,WAAW,EAAEN,UAAU,CAAC;QACnDK,MAAM,CAACC,mBAAmB,CAAC,WAAW,EAAEN,UAAU,CAAC;QACnDK,MAAM,CAACC,mBAAmB,CAAC,YAAY,EAAEJ,SAAS,CAAC;MACrD;IACF,CAAC;EAEH,CAAC,EAAE,CAAClB,WAAW,EAAEF,SAAS,CAAC,CAAC;EAE5B,OAAO;IAAEE,WAAW,EAAXA,WAAW;IAAEI,QAAQ,EAARA;EAAS,CAAC;AAClC"}