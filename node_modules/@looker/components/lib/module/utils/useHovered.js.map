{"version":3,"file":"useHovered.js","names":["useEffect","useState","getCurrentNode","useCallbackRef","useHovered","hoverElement","newElement","callbackRef","element","isHovered","setIsHovered","undefined","handleMouseEnter","handleMouseLeave","window","requestAnimationFrame","node","relationship","document","activeElement","compareDocumentPosition","Node","DOCUMENT_POSITION_DISCONNECTED","activeElementIsChildOfNode","DOCUMENT_POSITION_FOLLOWING","DOCUMENT_POSITION_CONTAINED_BY","addEventListener","removeEventListener"],"sources":["../../../src/utils/useHovered.ts"],"sourcesContent":["/**\n * Copyright (c) 2023 Google LLC\n * SPDX-License-Identifier: MIT\n */\n\nimport type { RefObject } from 'react'\nimport { useEffect, useState } from 'react'\nimport { getCurrentNode } from './getCurrentNode'\nimport { useCallbackRef } from './useCallbackRef'\n\n/**\n * Get the hover / focus state of an element over which the current component has no control\n */\nexport function useHovered<E extends HTMLElement = HTMLElement>(\n  hoverElement?: E | null | RefObject<E>\n): [boolean, ((node: E | null) => void) | null] {\n  const [newElement, callbackRef] = useCallbackRef<E>()\n  const element =\n    typeof hoverElement === 'undefined' ? newElement : hoverElement\n\n  // If the hoverElement is either null nor a dom node, isHovered defaults to false\n\n  // (This works well except for the edge case where\n  // element is under the mouse at time of dom attachment.\n  // If handling this edge case is crucial, use React callbacks onMouseEnter and onMouseLeave\n  // instead of this hook)\n\n  // If the hoverElement is undefined the hover \"gate\" is not being used so\n  // isHovered defaults to true\n  const [isHovered, setIsHovered] = useState(hoverElement === undefined)\n\n  useEffect(() => {\n    function handleMouseEnter() {\n      setIsHovered(true)\n    }\n    function handleMouseLeave() {\n      window.requestAnimationFrame(() => {\n        const node = getCurrentNode(element)\n\n        const relationship =\n          document.activeElement && node\n            ? node.compareDocumentPosition(document.activeElement)\n            : Node.DOCUMENT_POSITION_DISCONNECTED\n\n        // Don't set isHovered to false if a child of the element is currently focused\n        const activeElementIsChildOfNode =\n          relationship ===\n          Node.DOCUMENT_POSITION_FOLLOWING + Node.DOCUMENT_POSITION_CONTAINED_BY\n\n        if (!activeElementIsChildOfNode) setIsHovered(false)\n      })\n    }\n\n    const node = getCurrentNode(element)\n    if (node) {\n      node.addEventListener('mouseleave', handleMouseLeave)\n      node.addEventListener('mouseenter', handleMouseEnter)\n      node.addEventListener('focusout', handleMouseLeave)\n      node.addEventListener('focusin', handleMouseEnter)\n    }\n    return () => {\n      if (node) {\n        node.removeEventListener('mouseleave', handleMouseLeave)\n        node.removeEventListener('mouseenter', handleMouseEnter)\n        node.removeEventListener('focusout', handleMouseLeave)\n        node.removeEventListener('focusin', handleMouseEnter)\n      }\n    }\n  }, [element])\n\n  return [isHovered, callbackRef]\n}\n"],"mappings":";;AAMA,SAASA,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAC3C,SAASC,cAAc,QAAQ,kBAAkB;AACjD,SAASC,cAAc,QAAQ,kBAAkB;;AAKjD,OAAO,SAASC,UAAU,CACxBC,YAAsC,EACQ;EAC9C,MAAM,CAACC,UAAU,EAAEC,WAAW,CAAC,GAAGJ,cAAc,EAAK;EACrD,MAAMK,OAAO,GACX,OAAOH,YAAY,KAAK,WAAW,GAAGC,UAAU,GAAGD,YAAY;;EAWjE,MAAM,CAACI,SAAS,EAAEC,YAAY,CAAC,GAAGT,QAAQ,CAACI,YAAY,KAAKM,SAAS,CAAC;EAEtEX,SAAS,CAAC,MAAM;IACd,SAASY,gBAAgB,GAAG;MAC1BF,YAAY,CAAC,IAAI,CAAC;IACpB;IACA,SAASG,gBAAgB,GAAG;MAC1BC,MAAM,CAACC,qBAAqB,CAAC,MAAM;QACjC,MAAMC,IAAI,GAAGd,cAAc,CAACM,OAAO,CAAC;QAEpC,MAAMS,YAAY,GAChBC,QAAQ,CAACC,aAAa,IAAIH,IAAI,GAC1BA,IAAI,CAACI,uBAAuB,CAACF,QAAQ,CAACC,aAAa,CAAC,GACpDE,IAAI,CAACC,8BAA8B;;QAGzC,MAAMC,0BAA0B,GAC9BN,YAAY,KACZI,IAAI,CAACG,2BAA2B,GAAGH,IAAI,CAACI,8BAA8B;QAExE,IAAI,CAACF,0BAA0B,EAAEb,YAAY,CAAC,KAAK,CAAC;MACtD,CAAC,CAAC;IACJ;IAEA,MAAMM,IAAI,GAAGd,cAAc,CAACM,OAAO,CAAC;IACpC,IAAIQ,IAAI,EAAE;MACRA,IAAI,CAACU,gBAAgB,CAAC,YAAY,EAAEb,gBAAgB,CAAC;MACrDG,IAAI,CAACU,gBAAgB,CAAC,YAAY,EAAEd,gBAAgB,CAAC;MACrDI,IAAI,CAACU,gBAAgB,CAAC,UAAU,EAAEb,gBAAgB,CAAC;MACnDG,IAAI,CAACU,gBAAgB,CAAC,SAAS,EAAEd,gBAAgB,CAAC;IACpD;IACA,OAAO,MAAM;MACX,IAAII,IAAI,EAAE;QACRA,IAAI,CAACW,mBAAmB,CAAC,YAAY,EAAEd,gBAAgB,CAAC;QACxDG,IAAI,CAACW,mBAAmB,CAAC,YAAY,EAAEf,gBAAgB,CAAC;QACxDI,IAAI,CAACW,mBAAmB,CAAC,UAAU,EAAEd,gBAAgB,CAAC;QACtDG,IAAI,CAACW,mBAAmB,CAAC,SAAS,EAAEf,gBAAgB,CAAC;MACvD;IACF,CAAC;EACH,CAAC,EAAE,CAACJ,OAAO,CAAC,CAAC;EAEb,OAAO,CAACC,SAAS,EAAEF,WAAW,CAAC;AACjC"}