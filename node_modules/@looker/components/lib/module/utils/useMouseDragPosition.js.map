{"version":3,"file":"useMouseDragPosition.js","names":["useState","useEffect","throttle","get","useMouseDragPosition","targetRef","isMouseDown","setIsMouseDown","mousePos","setMousePos","x","y","updateMousePos","e","event","pageX","clientX","pageY","clientY","handleStart","requestAnimationFrame","handleMove","handleEnd","addEventListener","window","removeEventListener"],"sources":["../../../src/utils/useMouseDragPosition.ts"],"sourcesContent":["/**\n * Copyright (c) 2023 Google LLC\n * SPDX-License-Identifier: MIT\n */\n\nimport { useState, useEffect } from 'react'\nimport throttle from 'lodash/throttle'\nimport get from 'lodash/get'\n\ninterface MouseState {\n  mousePos: { x: number; y: number }\n  isMouseDown: boolean\n}\n\n/*\n * Starts tracking mouse position when user clicks inside targetRef.\n * Stops  updating mouse position when user releases mouse ANYWHERE in the window\n */\nexport function useMouseDragPosition(\n  targetRef: HTMLElement | null\n): MouseState {\n  const [isMouseDown, setIsMouseDown] = useState(false)\n  const [mousePos, setMousePos] = useState({ x: 0, y: 0 })\n\n  const updateMousePos = (e: globalThis.TouchEvent | globalThis.MouseEvent) => {\n    // use e.touches[0] for touch events, or simply e for mouse events\n    const event = get(e, 'touches[0]', e)\n    // e.clientX and e.clientY fallbacks are included for testing purposes. jsDOM doesn't support pageX/pageY attributes\n    const { pageX, clientX, pageY, clientY } = event\n    setMousePos({ x: pageX || clientX, y: pageY || clientY })\n  }\n\n  const handleStart = (e: globalThis.TouchEvent | globalThis.MouseEvent) => {\n    // update mouse down state AFTER mouse position state is updated\n    requestAnimationFrame(() => {\n      setIsMouseDown(true)\n    })\n    updateMousePos(e)\n  }\n\n  const handleMove = throttle(updateMousePos, 100)\n\n  const handleEnd = () => {\n    requestAnimationFrame(() => {\n      setIsMouseDown(false)\n    })\n  }\n\n  useEffect(() => {\n    targetRef && targetRef.addEventListener('mousedown', handleStart)\n    targetRef && targetRef.addEventListener('touchstart', handleStart)\n    window.addEventListener('mouseup', handleEnd)\n    window.addEventListener('touchend', handleEnd)\n\n    if (isMouseDown) {\n      window.addEventListener('touchmove', handleMove)\n      window.addEventListener('mousemove', handleMove)\n      window.addEventListener('mouseleave', handleEnd)\n    }\n\n    return () => {\n      targetRef && targetRef.removeEventListener('mousedown', handleStart)\n      targetRef && targetRef.removeEventListener('touchstart', handleStart)\n      window.removeEventListener('mouseup', handleEnd)\n      window.removeEventListener('touchend', handleEnd)\n\n      if (isMouseDown) {\n        window.removeEventListener('touchmove', handleMove)\n        window.removeEventListener('mousemove', handleMove)\n        window.removeEventListener('mouseleave', handleEnd)\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isMouseDown, targetRef])\n\n  return { isMouseDown, mousePos }\n}\n"],"mappings":";;AAKA,SAASA,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAC3C,OAAOC,QAAQ,MAAM,iBAAiB;AACtC,OAAOC,GAAG,MAAM,YAAY;AAW5B,OAAO,SAASC,oBAAoB,CAClCC,SAA6B,EACjB;EACZ,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC,GAAGP,QAAQ,CAAC,KAAK,CAAC;EACrD,MAAM,CAACQ,QAAQ,EAAEC,WAAW,CAAC,GAAGT,QAAQ,CAAC;IAAEU,CAAC,EAAE,CAAC;IAAEC,CAAC,EAAE;EAAE,CAAC,CAAC;EAExD,MAAMC,cAAc,GAAIC,CAAgD,IAAK;IAE3E,MAAMC,KAAK,GAAGX,GAAG,CAACU,CAAC,EAAE,YAAY,EAAEA,CAAC,CAAC;IAErC,MAAM;MAAEE,KAAK;MAAEC,OAAO;MAAEC,KAAK;MAAEC;IAAQ,CAAC,GAAGJ,KAAK;IAChDL,WAAW,CAAC;MAAEC,CAAC,EAAEK,KAAK,IAAIC,OAAO;MAAEL,CAAC,EAAEM,KAAK,IAAIC;IAAQ,CAAC,CAAC;EAC3D,CAAC;EAED,MAAMC,WAAW,GAAIN,CAAgD,IAAK;IAExEO,qBAAqB,CAAC,MAAM;MAC1Bb,cAAc,CAAC,IAAI,CAAC;IACtB,CAAC,CAAC;IACFK,cAAc,CAACC,CAAC,CAAC;EACnB,CAAC;EAED,MAAMQ,UAAU,GAAGnB,QAAQ,CAACU,cAAc,EAAE,GAAG,CAAC;EAEhD,MAAMU,SAAS,GAAG,MAAM;IACtBF,qBAAqB,CAAC,MAAM;MAC1Bb,cAAc,CAAC,KAAK,CAAC;IACvB,CAAC,CAAC;EACJ,CAAC;EAEDN,SAAS,CAAC,MAAM;IACdI,SAAS,IAAIA,SAAS,CAACkB,gBAAgB,CAAC,WAAW,EAAEJ,WAAW,CAAC;IACjEd,SAAS,IAAIA,SAAS,CAACkB,gBAAgB,CAAC,YAAY,EAAEJ,WAAW,CAAC;IAClEK,MAAM,CAACD,gBAAgB,CAAC,SAAS,EAAED,SAAS,CAAC;IAC7CE,MAAM,CAACD,gBAAgB,CAAC,UAAU,EAAED,SAAS,CAAC;IAE9C,IAAIhB,WAAW,EAAE;MACfkB,MAAM,CAACD,gBAAgB,CAAC,WAAW,EAAEF,UAAU,CAAC;MAChDG,MAAM,CAACD,gBAAgB,CAAC,WAAW,EAAEF,UAAU,CAAC;MAChDG,MAAM,CAACD,gBAAgB,CAAC,YAAY,EAAED,SAAS,CAAC;IAClD;IAEA,OAAO,MAAM;MACXjB,SAAS,IAAIA,SAAS,CAACoB,mBAAmB,CAAC,WAAW,EAAEN,WAAW,CAAC;MACpEd,SAAS,IAAIA,SAAS,CAACoB,mBAAmB,CAAC,YAAY,EAAEN,WAAW,CAAC;MACrEK,MAAM,CAACC,mBAAmB,CAAC,SAAS,EAAEH,SAAS,CAAC;MAChDE,MAAM,CAACC,mBAAmB,CAAC,UAAU,EAAEH,SAAS,CAAC;MAEjD,IAAIhB,WAAW,EAAE;QACfkB,MAAM,CAACC,mBAAmB,CAAC,WAAW,EAAEJ,UAAU,CAAC;QACnDG,MAAM,CAACC,mBAAmB,CAAC,WAAW,EAAEJ,UAAU,CAAC;QACnDG,MAAM,CAACC,mBAAmB,CAAC,YAAY,EAAEH,SAAS,CAAC;MACrD;IACF,CAAC;EAEH,CAAC,EAAE,CAAChB,WAAW,EAAED,SAAS,CAAC,CAAC;EAE5B,OAAO;IAAEC,WAAW;IAAEE;EAAS,CAAC;AAClC"}